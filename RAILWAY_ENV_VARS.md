# Railway Environment Variables Configuration

This document lists all required and optional environment variables for deploying this NestJS backend on Railway.

## Required Environment Variables

### Database Configuration (PostgreSQL)
Railway provides PostgreSQL as a service. When you add a PostgreSQL service, Railway automatically provides these variables. You can reference them in your web service:

- **`DB_HOST`** - PostgreSQL host (e.g., `containers-us-west-xxx.railway.app`)
- **`DB_PORT`** - PostgreSQL port (usually `5432`)
- **`DB_USERNAME`** - PostgreSQL username (usually `postgres`)
- **`DB_PASSWORD`** - PostgreSQL password (auto-generated by Railway)
- **`DB_NAME`** - Database name (e.g., `railway` or your custom name)

**Railway Setup:**
1. Add a PostgreSQL service to your project
2. In your web service, add these environment variables and reference them from the PostgreSQL service:
   - `DB_HOST` → Reference from PostgreSQL service → `PGHOST`
   - `DB_PORT` → Reference from PostgreSQL service → `PGPORT`
   - `DB_USERNAME` → Reference from PostgreSQL service → `PGUSER`
   - `DB_PASSWORD` → Reference from PostgreSQL service → `PGPASSWORD`
   - `DB_NAME` → Reference from PostgreSQL service → `PGDATABASE`

### Redis Configuration
Railway provides Redis as a service. When you add a Redis service, Railway automatically provides connection details:

- **`REDIS_HOST`** - Redis host (e.g., `containers-us-west-xxx.railway.app`)
- **`REDIS_PORT`** - Redis port (usually `6379`)
- **`REDIS_PASSWORD`** - Redis password (optional, if your Redis instance requires authentication)

**Railway Setup:**
1. Add a Redis service to your project
2. In your web service, add these environment variables and reference them from the Redis service:
   - `REDIS_HOST` → Reference from Redis service → `REDIS_HOST`
   - `REDIS_PORT` → Reference from Redis service → `REDIS_PORT`
   - `REDIS_PASSWORD` → Reference from Redis service → `REDIS_PASSWORD` (if available)

### Application Configuration

- **`JWT_SECRET`** - Secret key for JWT token signing and verification
  - **IMPORTANT**: Generate a strong, random secret for production
  - Example: Use `openssl rand -base64 32` to generate a secure secret
  - **DO NOT** use the default value in production

- **`NODE_ENV`** - Environment mode
  - Set to: `production` for Railway deployment
  - This disables database auto-synchronization and enables production optimizations

- **`PORT`** - Server port
  - Railway automatically provides this via the `PORT` environment variable
  - Your application already uses `process.env.PORT || 3200`, so this should work automatically
  - **Note**: You may not need to set this manually, Railway injects it automatically

- **`FRONTEND_URL`** - Frontend URL for CORS configuration
  - Set this to your frontend application URL (e.g., `https://your-frontend.railway.app` or `https://yourdomain.com`)
  - This is used to allow cross-origin requests from your frontend
  - **Required in production** to allow your frontend to make API requests

## Quick Setup Guide for Railway

### Step 1: Add Services
1. Add a **PostgreSQL** service to your Railway project
2. Add a **Redis** service to your Railway project
3. Add a **Web Service** (your NestJS backend)

### Step 2: Configure Environment Variables in Web Service

Go to your Web Service → Variables tab and add:

#### Database Variables (Reference from PostgreSQL service)
```
DB_HOST = ${{PostgreSQL.PGHOST}}
DB_PORT = ${{PostgreSQL.PGPORT}}
DB_USERNAME = ${{PostgreSQL.PGUSER}}
DB_PASSWORD = ${{PostgreSQL.PGPASSWORD}}
DB_NAME = ${{PostgreSQL.PGDATABASE}}
```

#### Redis Variables (Reference from Redis service)
```
REDIS_HOST = ${{Redis.REDIS_HOST}}
REDIS_PORT = ${{Redis.REDIS_PORT}}
REDIS_PASSWORD = ${{Redis.REDIS_PASSWORD}}  (if available)
```

#### Application Variables (Set manually)
```
JWT_SECRET = <generate-a-strong-random-secret>
NODE_ENV = production
FRONTEND_URL = https://your-frontend-url.com
```

### Step 3: Configure Build and Start Commands

In your Web Service settings:

**Build Command:**
```bash
npm ci && npm run build
```

**Start Command:**
```bash
node dist/main.js
```

Or if you prefer using the start script:
```bash
./start.sh
```

(Note: Make sure `start.sh` has execute permissions, Railway should handle this automatically)

## Environment Variables Summary Table

| Variable | Required | Default | Description | Source |
|----------|----------|---------|-------------|--------|
| `DB_HOST` | ✅ Yes | `localhost` | PostgreSQL host | Railway PostgreSQL service |
| `DB_PORT` | ✅ Yes | `5432` | PostgreSQL port | Railway PostgreSQL service |
| `DB_USERNAME` | ✅ Yes | `postgres` | PostgreSQL username | Railway PostgreSQL service |
| `DB_PASSWORD` | ✅ Yes | `postgres` | PostgreSQL password | Railway PostgreSQL service |
| `DB_NAME` | ✅ Yes | `rpg_blog` | Database name | Railway PostgreSQL service |
| `REDIS_HOST` | ✅ Yes | `localhost` | Redis host | Railway Redis service |
| `REDIS_PORT` | ✅ Yes | `6379` | Redis port | Railway Redis service |
| `REDIS_PASSWORD` | ⚠️ Optional | `undefined` | Redis password | Railway Redis service (if auth enabled) |
| `JWT_SECRET` | ✅ Yes | - | JWT signing secret | **Manual (generate secure value)** |
| `NODE_ENV` | ✅ Yes | - | Environment mode | **Manual (set to `production`)** |
| `PORT` | ⚠️ Auto | `3200` | Server port | **Railway auto-injects** |
| `FRONTEND_URL` | ✅ Yes (Prod) | - | Frontend URL for CORS | **Manual (your frontend URL)** |

## Security Notes

1. **JWT_SECRET**: Never commit this to version control. Generate a unique, strong secret for production.
2. **Database Credentials**: Railway automatically manages these, but never expose them in logs or client-side code.
3. **Redis Password**: If your Railway Redis instance requires authentication, make sure to set `REDIS_PASSWORD`.
4. **NODE_ENV**: Always set to `production` in Railway to:
   - Disable database auto-synchronization (use migrations instead)
   - Enable production optimizations
   - Disable verbose logging

## Testing Your Configuration

After setting up all variables, you can verify they're loaded correctly by checking your application logs. The application should:
1. Connect to PostgreSQL successfully
2. Connect to Redis successfully
3. Start listening on the PORT provided by Railway
4. Allow CORS requests from your FRONTEND_URL

## Troubleshooting

- **Database connection errors**: Verify all DB_* variables are correctly referenced from PostgreSQL service
- **Redis connection errors**: Verify REDIS_HOST, REDIS_PORT, and REDIS_PASSWORD (if required)
- **CORS errors**: Ensure FRONTEND_URL matches your actual frontend URL exactly
- **Port errors**: Railway automatically provides PORT, but if issues occur, check that your app uses `process.env.PORT`

